<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Friend Finder Survey</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <style>
        .btn-file {
            position: relative;
            overflow: hidden;
        }

        .btn-file input[type=file] {
            position: absolute;
            top: 0;
            right: 0;
            min-width: 100%;
            min-height: 100%;
            font-size: 100px;
            text-align: right;
            filter: alpha(opacity=0);
            opacity: 0;
            outline: none;
            background: white;
            cursor: inherit;
            display: block;
        }
    </style>

</head>

<body>

    <div class="container">
        <div class="jumbotron">
            <h1>Survey</h1>
            <hr>

        </div>
        <div class="row">

            <div class="col-12">
                <h3>Your Name (Required)</h3>
                <form class="form-group">
                    <label for="name"></label>
                    <input type="text" class="form-control" id="name">
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <div class="form-group">
                    <label>
                        <h3>Upload Image</h3>
                    </label>
                    <div class="input-group">
                        <span class="input-group-btn">
                            <button class="btn btn-default btn-file">
                                Browseâ€¦
                                <input type="file" id="imgInp">
                            </button>
                        </span>
                        <input type="text" class="form-control" readonly>
                    </div>
                    <br>
                    <br>
                    <img id='img-upload' />
                </div>

            </div>
        </div>

        <div class="row">

            <div class="col-12">
                <h3>Question 1</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionOne">Your mind is always buzzing with un-explored ideas or plans</label>
                    <select class="form-control" id="q1">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 2</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionTwo">You rely more on experience than imagination</label>
                    <select class="form-control" id="q2">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 3</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionThree">You stay relaxed under pressure</label>
                    <select class="form-control" id="q3">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 4</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionFour">You rarely do something out of sheer curiosity</label>
                    <select class="form-control" id="q4">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 5</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionFive">People rarely upset you</label>
                    <select class="form-control" id="q5">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 6</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionSix">You find it difficult to relate to other people's feelings</label>
                    <select class="form-control" id="q6">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 7</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionSeven">You believe that the truth is more important than people's feelings</label>
                    <select class="form-control" id="q7">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 8</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionEight">You think that everyones views should be respected even though they are not supported by facts</label>
                    <select class="form-control" id="q8">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 9</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionNine">You rarely get carried away by fantasies or ideas</label>
                    <select class="form-control" id="q9">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <h3>Question 10</h3>
                <form class="form-group">
                    <label class="my-1 mr-2" for="questionTen">You feel more energetic around a group of people</label>
                    <select class="form-control" id="q10">
                        <option selected>Choose...</option>
                        <option value="1">1 Strongly disagree</option>
                        <option value="2">2 Disagree</option>
                        <option value="3">3 Neutral</option>
                        <option value="4">4 Agree</option>
                        <option value="5">5 Strongly Agree</option>
                    </select>
                </form>

            </div>
        </div>
        <div class="row">

            <div class="col-12">
                <button class="btn btn-danger btn-lg" id="submit" data-toggle="modal" data-target="#matches">
                    <span class="fa fa-plus"></span>Submit </button>
            </div>
        </div>
    </div>

    <!-- modal pop up for matches -->

    <div class="modal fade" id="matches" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Your Matches</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(() => {
            let newElement = $(`<div>`);
            newElement.addClass("card-body");

            $(document).on('change', '.btn-file :file', function () {
                var input = $(this),
                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                input.trigger('fileselect', [label]);
            });

            $('.btn-file :file').on('fileselect', function (event, label) {

                var input = $(this).parents('.input-group').find(':text'),
                    log = label;

                if (input.length) {
                    input.val(log);
                } else {
                    if (log) alert(log);
                }

            });
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#img-upload').attr('src', e.target.result);
                    }

                    reader.readAsDataURL(input.files[0]);
                }
            }

            $("#imgInp").change(function () {
                readURL(this);
            });


            //event listener for submit button
            //call back takes all data from input fields and stores it in a temp object
            //temp object is then posted to API
            $("#submit").on("click", (event) => {
                event.preventDefault();
                let tempArray = [];
                for (let i = 0; i < 10; i++) {
                    tempArray.push(parseInt($("#q" + (i + 1)).val()));
                }
                let tempObj = {
                    name: $("#name").val().trim(),
                    photo: $("#imgInp").val().trim(),
                    scores: tempArray,

                }

                //clear all fields
                for (let i = 0; i < 10; i++) {
                    $("#q" + (i + 1)).val("");
                }
                $("#name").val("");
                $("#img-upload").attr('src', "");


                $.post("/api/friends", tempObj, (data) => {
                    $('.modal-body').empty();
                    if (!data) {
                        newElement.text("There are no friends for you to match with");
                        $('.modal-body').append(newElement);
                    } else {
                        data.map((x) => {
                            let imageElement = $(`<img>`);
                            let pageBreak = $(`<br>`);
                            let nameElement = $(`<h5>`);
                            nameElement.text(x.name);
                            imageElement.attr("src", x.photo);
                            newElement.append(imageElement);
                            newElement.append(nameElement);
                            $('.modal-body').append(newElement);
                            $('.modal-body').append(pageBreak);

                        });
                    }

                });

            });
        })


    </script>
</body>

</html>